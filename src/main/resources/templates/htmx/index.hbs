<html>
<head>
    <meta charset="UTF-8">
    <title>SimulIDE - Collaborative Code Editor</title>
    <script src="https://unpkg.com/htmx.org@2.0.3" integrity="sha384-0895/pl2MU10Hqc6jd4RvrthNlDiE9U1tWmX7WRESftEDRosgxNsQG/Ze9YMRzHq" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <style>
        /* Additional custom styles */
        .code-editor, .test-editor {
            min-height: 300px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
            overflow-y: auto;
            font-family: monospace;
        }
        .test-result-pane {
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body class="has-background-light">
<!-- Header Section -->
<section class="section">
    <div class="container">
        <nav class="level">
            <!-- Title -->
            <div class="level-left">
                <div class="level-item">
                    <h1 class="title">Collaborative Code Editor</h1>
                </div>
            </div>

            <!-- User Actions -->
            <div class="level-right">
                <div class="level-item">
                    <button class="button is-info" hx-post="/save-code" hx-trigger="click" hx-target="#notification" hx-ext="saveCode">Save</button>
                </div>
                <div class="level-item">
                    <button class="button is-primary" hx-post="/execute-tests" hx-trigger="click" hx-target="#test-results">Run Tests</button>
                </div>
                <div class="level-item">
                    <button class="button is-light">Logout</button>
                </div>
            </div>
        </nav>
    </div>
</section>

<!-- Main Code Editor Section -->
<section class="section">
    <div class="container">
        <div class="columns is-variable is-6">
            <!-- Online Users -->
            <div class="column is-2">
                <aside class="menu">
                    <p class="menu-label">Users Online</p>
                    <ul class="menu-list">
                        <li><a>User 1 ðŸŸ¢</a></li>
                        <li><a>User 2 ðŸŸ¢</a></li>
                        <li><a>User 3 ðŸŸ¡</a></li>
                        <li><a>User 4 ðŸ”´</a></li>
                    </ul>
                </aside>
            </div>

            <!-- Code and Test Editors -->
            <div class="column is-7">
                <!-- Code Editor -->
                <div class="box">
                    <h2 class="subtitle">JavaScript Code Editor</h2>
                    <div id="code-editor" contenteditable="true" class="code-editor">
                        // Write your JavaScript code here...
                    </div>
                </div>

                <!-- Test Editor -->
                <div class="box mt-4">
                    <h2 class="subtitle">Jasmine Test Editor</h2>
                    <div id="test-editor" contenteditable="true" class="test-editor">
                        // Write your Jasmine tests here...
                    </div>
                </div>
            </div>

            <!-- Test Result Pane -->
            <div class="column is-3">
                <div class="box">
                    <h2 class="subtitle">Test Results</h2>
                    <div id="test-results" class="test-result-pane">
                        <p>Test results will appear here after you run tests.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Notification Section -->
<section class="section">
    <div class="container">
        <div id="notification" class="notification is-info is-hidden">
            <button class="delete"></button>
            <!-- Success or error messages from save operations will appear here -->
        </div>
    </div>
</section>

<!-- Chat Section -->
<section class="section">
    <div class="container">
        <div class="box">
            <h2 class="subtitle">Collaborative Chat</h2>
            <div id="chat" class="content">
                <p><strong>User 1:</strong> Hey, can we add a test for this function?</p>
                <p><strong>User 2:</strong> Sure, let me work on that.</p>
            </div>
            <div class="field has-addons mt-4">
                <div class="control is-expanded">
                    <input class="input" type="text" placeholder="Type your message here...">
                </div>
                <div class="control">
                    <button class="button is-link">Send</button>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
  htmx.defineExtension('saveCode', {
    onEvent: function (name, evt) {
      if (name === "htmx:configRequest") {
        evt.detail.headers['Content-Type'] = "application/json";
        evt.detail.headers['X-CSRF-Token'] = {{ data.csrfToken }};
      }
    },
    encodeParameters: function(xhr, parameters, elt) {
      xhr.overrideMimeType('text/json'); // override default mime type
      const editorContent = document.getElementById("code-editor").innerText;
      const body = {
         code: editorContent
      };
      return (JSON.stringify(body));
    }
  });
</script>

</body>
</html>